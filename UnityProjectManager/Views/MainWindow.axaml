<Window xmlns="https://github.com/avaloniaui"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:vm="using:UnityProjectManager.ViewModels"
        xmlns:views="using:UnityProjectManager.Views"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        xmlns:conv="using:UnityProjectManager.Converters"
        xmlns:ui="using:FluentAvalonia.UI.Controls"
        mc:Ignorable="d" d:DesignWidth="1000" d:DesignHeight="600"
        x:Class="UnityProjectManager.Views.MainWindow"
        x:DataType="vm:MainWindowViewModel"
        Icon="/Assets/avalonia-logo.ico"
        Title="Unity Project Manager"
        TransparencyLevelHint="Mica"
        Background="Transparent"
        ExtendClientAreaToDecorationsHint="True">

    <Design.DataContext>
        <vm:MainWindowViewModel/>
    </Design.DataContext>

    <Window.Resources>
        <conv:PathToBitmapConverter x:Key="PathToBitmapConverter"/>
    </Window.Resources>

    <Grid>
       <!-- Main Layout -->
       <SplitView IsPaneOpen="True"
                  DisplayMode="Inline"
                  OpenPaneLength="240"
                  PaneBackground="#40000000"
                  Background="Transparent">
           
           <SplitView.Pane>
               <Border Margin="0,30,0,0" Padding="10">
                   <StackPanel Spacing="5">
                       <TextBlock Text="LIBRARY" FontWeight="Bold" Foreground="#888888" Margin="8,0,0,10" FontSize="12"/>
                       
                       <ListBox Background="Transparent" CornerRadius="4">
                           <ListBox.Styles>
                               <Style Selector="ListBoxItem">
                                    <Setter Property="Padding" Value="10,8"/>
                                    <Setter Property="CornerRadius" Value="4"/>
                               </Style>
                           </ListBox.Styles>
                           <ListBoxItem IsSelected="True">
                               <StackPanel Orientation="Horizontal" Spacing="10">
                                   <!-- <ui:SymbolIcon Symbol="Library" /> -->
                                   <TextBlock Text="Projects"/>
                               </StackPanel>
                           </ListBoxItem>
                           <ListBoxItem>
                               <StackPanel Orientation="Horizontal" Spacing="10">
                                   <TextBlock Text="Installs"/>
                               </StackPanel>
                           </ListBoxItem>
                           <ListBoxItem>
                               <StackPanel Orientation="Horizontal" Spacing="10">
                                   <TextBlock Text="Learn"/>
                               </StackPanel>
                           </ListBoxItem>
                       </ListBox>
                       
                       <TextBlock Text="WATCH FOLDERS" FontWeight="Bold" Foreground="#888888" Margin="8,20,0,10" FontSize="12"/>
                       <Button Content="Add Folder" HorizontalAlignment="Stretch" HorizontalContentAlignment="Left" />
                   </StackPanel>
               </Border>
           </SplitView.Pane>

           <SplitView.Content>
                <Grid RowDefinitions="Auto,*" Margin="0,30,0,0">
                     <!-- Header -->
                     <TextBlock Text="Projects" FontSize="28" FontWeight="SemiLight" Margin="40,20,0,20" />
                     
                     <ScrollViewer Grid.Row="1" Padding="40,0,40,40">
                         <ItemsControl ItemsSource="{Binding Projects}">
                             <ItemsControl.ItemsPanel>
                                 <ItemsPanelTemplate>
                                     <WrapPanel />
                                 </ItemsPanelTemplate>
                             </ItemsControl.ItemsPanel>
                             <ItemsControl.ItemTemplate>
                                 <DataTemplate>
                                     <views:ProjectCardView />
                                 </DataTemplate>
                             </ItemsControl.ItemTemplate>
                         </ItemsControl>
                     </ScrollViewer>
                </Grid>
           </SplitView.Content>
       </SplitView>
       
       <!-- Details Overlay -->
       <Grid IsVisible="{Binding IsDetailsOpen}" Background="#AA000000">
           <!-- Click background to close -->
           <Button Background="Transparent" HorizontalAlignment="Stretch" VerticalAlignment="Stretch" 
                   Command="{Binding CloseProjectDetailsCommand}" />
           
           <!-- Content Modal -->
           <Border Background="#252525" Width="900" Height="500" CornerRadius="12" BoxShadow="0 10 30 0 #000000">
               <Grid ColumnDefinitions="300,*" RowDefinitions="Auto,*">
                   
                   <!-- Left Sidebar: Project Info -->
                   <Border Grid.RowSpan="2" Background="#1E1E1E" CornerRadius="12,0,0,12" Padding="20">
                       <StackPanel Spacing="16">
                           <!-- Large Thumbnail -->
                           <Border CornerRadius="8" ClipToBounds="True" Height="160">
                               <Image Source="{Binding SelectedProject.ThumbnailPath, Converter={StaticResource PathToBitmapConverter}}" 
                                      Stretch="UniformToFill"/>
                           </Border>
                           
                           <TextBlock Text="{Binding SelectedProject.Name}" FontSize="24" FontWeight="Bold" TextWrapping="Wrap"/>
                           
                           <StackPanel Spacing="4">
                               <TextBlock Text="UNITY VERSION" FontWeight="Bold" FontSize="10" Foreground="#888888"/>
                               <TextBlock Text="{Binding SelectedProject.UnityVersion}" FontSize="14"/>
                           </StackPanel>
                           
                           <StackPanel Spacing="4">
                               <TextBlock Text="LOCATION" FontWeight="Bold" FontSize="10" Foreground="#888888"/>
                               <TextBlock Text="{Binding SelectedProject.Path}" FontSize="12" Foreground="#CCCCCC" TextWrapping="Wrap"/>
                           </StackPanel>

                           <Button Content="Open Project" Classes="accent" HorizontalAlignment="Stretch" Margin="0,20,0,0"/>
                           <Button Content="Close Details" Command="{Binding CloseProjectDetailsCommand}" HorizontalAlignment="Stretch"/>
                       </StackPanel>
                   </Border>
                   
                   <!-- Right Content: Packages -->
                   <Border Grid.Column="1" Grid.Row="0" Padding="30,20" BorderBrush="#333333" BorderThickness="0,0,0,1">
                       <Grid ColumnDefinitions="*,Auto">
                           <TextBlock Text="Installed Packages" FontSize="20" FontWeight="SemiLight" VerticalAlignment="Center"/>
                           <!-- Future: Search Box -->
                           <Button Grid.Column="1" Content="Add Package" />
                       </Grid>
                   </Border>
                   
                   <ListBox Grid.Column="1" Grid.Row="1" ItemsSource="{Binding Packages}" Background="Transparent" Margin="0,10">
                       <ListBox.Styles>
                           <Style Selector="ListBoxItem">
                               <Setter Property="Padding" Value="20,10"/>
                           </Style>
                       </ListBox.Styles>
                       <ListBox.ItemTemplate>
                           <DataTemplate>
                               <Grid ColumnDefinitions="*,100,Auto">
                                   <StackPanel Spacing="2">
                                       <TextBlock Text="{Binding Name}" FontWeight="SemiBold" FontSize="14"/>
                                   </StackPanel>
                                   
                                   <TextBlock Grid.Column="1" Text="{Binding Version}" Foreground="#AAFFFFFF" VerticalAlignment="Center"/>
                                   
                                   <Button Grid.Column="2" Content="Remove" FontSize="11" Padding="8,4" Background="#333333"/>
                               </Grid>
                           </DataTemplate>
                       </ListBox.ItemTemplate>
                   </ListBox>
               </Grid>
           </Border>
       </Grid>
    </Grid>
</Window>
