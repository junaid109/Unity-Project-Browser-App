<Window xmlns="https://github.com/avaloniaui"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:vm="using:UnityProjectManager.ViewModels"
        xmlns:views="using:UnityProjectManager.Views"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        xmlns:conv="using:UnityProjectManager.Converters"
        xmlns:ui="using:FluentAvalonia.UI.Controls"
        mc:Ignorable="d" d:DesignWidth="1000" d:DesignHeight="600"
        x:Class="UnityProjectManager.Views.MainWindow"
        x:DataType="vm:MainWindowViewModel"
        Icon="/Assets/avalonia-logo.ico"
        Title="Unity Project Manager"
        TransparencyLevelHint="Mica"
        Background="Transparent"
        ExtendClientAreaToDecorationsHint="True">

    <Design.DataContext>
        <vm:MainWindowViewModel/>
    </Design.DataContext>

    <Window.Resources>
        <conv:PathToBitmapConverter x:Key="PathToBitmapConverter"/>
        <conv:StringEqualsConverter x:Key="StringEqualsConverter"/>
    </Window.Resources>

    <Grid>
       <!-- Main Layout -->
       <SplitView IsPaneOpen="True"
                  DisplayMode="Inline"
                  OpenPaneLength="240"
                  PaneBackground="#40000000"
                  Background="Transparent">
           
           <SplitView.Pane>
               <Border Margin="0,30,0,0" Padding="10">
                   <StackPanel Spacing="5">
                       <TextBlock Text="LIBRARY" FontWeight="Bold" Foreground="#888888" Margin="8,0,0,10" FontSize="12"/>
                       
                       <StackPanel Spacing="2">
                           <Button Content="Projects" Command="{Binding SelectTabCommand}" CommandParameter="Projects"
                                   HorizontalAlignment="Stretch" HorizontalContentAlignment="Left" Padding="12,8"
                                   Background="{Binding SelectedTab, Converter={StaticResource StringEqualsConverter}, ConverterParameter='Projects', Converter={StaticResource StringEqualsConverter}}"/> <!-- Note: I need a color converter for highlighting, but for now just function -->
                           <Button Content="Installs" Command="{Binding SelectTabCommand}" CommandParameter="Installs"
                                   HorizontalAlignment="Stretch" HorizontalContentAlignment="Left" Padding="12,8" Background="Transparent"/>
                           <Button Content="Learn" Command="{Binding SelectTabCommand}" CommandParameter="Learn"
                                   HorizontalAlignment="Stretch" HorizontalContentAlignment="Left" Padding="12,8" Background="Transparent"/>
                       </StackPanel>
                       
                       <TextBlock Text="WATCH FOLDERS" FontWeight="Bold" Foreground="#888888" Margin="8,20,0,10" FontSize="12"/>
                       <Button x:Name="AddFolderButton" Content="Add Folder" HorizontalAlignment="Stretch" HorizontalContentAlignment="Left" Padding="12,8" />
                       
                       <TextBlock Text="TOOLS" FontWeight="Bold" Foreground="#888888" Margin="8,20,0,10" FontSize="12"/>
                       <Button Content="Sync with Unity Hub" Command="{Binding SyncWithHubCommand}" HorizontalAlignment="Stretch" HorizontalContentAlignment="Left" Padding="12,8">
                           <Button.Styles>
                               <Style Selector="Button">
                                   <Setter Property="Background" Value="Transparent"/>
                                   <Setter Property="BorderThickness" Value="1"/>
                                   <Setter Property="BorderBrush" Value="#333333"/>
                               </Style>
                           </Button.Styles>
                       </Button>
                   </StackPanel>
               </Border>
           </SplitView.Pane>

           <SplitView.Content>
                <Grid Margin="0,30,0,0">
                     <!-- Page: Projects -->
                     <Grid RowDefinitions="Auto,*" IsVisible="{Binding SelectedTab, Converter={StaticResource StringEqualsConverter}, ConverterParameter='Projects'}">
                          <TextBlock Text="Projects" FontSize="28" FontWeight="SemiLight" Margin="40,20,0,20" />
                          <ScrollViewer Grid.Row="1" Padding="40,0,40,40">
                              <ItemsControl ItemsSource="{Binding Projects}">
                                  <ItemsControl.ItemsPanel>
                                      <ItemsPanelTemplate>
                                          <WrapPanel />
                                      </ItemsPanelTemplate>
                                  </ItemsControl.ItemsPanel>
                                  <ItemsControl.ItemTemplate>
                                      <DataTemplate>
                                          <views:ProjectCardView />
                                      </DataTemplate>
                                  </ItemsControl.ItemTemplate>
                              </ItemsControl>
                          </ScrollViewer>
                     </Grid>

                     <!-- Page: Installs -->
                     <Grid RowDefinitions="Auto,*" IsVisible="{Binding SelectedTab, Converter={StaticResource StringEqualsConverter}, ConverterParameter='Installs'}">
                          <TextBlock Text="Installs" FontSize="28" FontWeight="SemiLight" Margin="40,20,0,20" />
                          <ScrollViewer Grid.Row="1" Padding="40,0,40,40">
                              <ItemsControl ItemsSource="{Binding InstalledEditors}">
                                  <ItemsControl.ItemTemplate>
                                      <DataTemplate>
                                          <Border Background="#1A1A1A" Margin="0,0,0,8" Padding="20" CornerRadius="8" BorderBrush="#333333" BorderThickness="1">
                                              <Grid ColumnDefinitions="*,Auto">
                                                  <StackPanel Spacing="5">
                                                      <TextBlock Text="{Binding}" FontSize="14" FontWeight="SemiBold"/>
                                                      <TextBlock Text="Unity Editor" FontSize="11" Foreground="#666666"/>
                                                  </StackPanel>
                                                  <Button Grid.Column="1" Content="Locate" Background="Transparent" BorderBrush="#444444" Padding="15,5"/>
                                              </Grid>
                                          </Border>
                                      </DataTemplate>
                                  </ItemsControl.ItemTemplate>
                              </ItemsControl>
                          </ScrollViewer>
                     </Grid>

                      <!-- Page: Learn -->
                      <Grid RowDefinitions="Auto,Auto,*" IsVisible="{Binding SelectedTab, Converter={StaticResource StringEqualsConverter}, ConverterParameter='Learn'}">
                          <TextBlock Text="Unity Learn" FontSize="28" FontWeight="SemiLight" Margin="40,20,0,10" />
                          
                          <!-- Search Bar -->
                          <Border Grid.Row="1" Margin="40,10,40,20" Background="#1A1A1A" CornerRadius="8" BorderBrush="#333333" BorderThickness="1">
                              <Grid ColumnDefinitions="*,Auto">
                                  <TextBox Text="{Binding LearnSearchQuery}" Watermark="Search tutorials, courses, and pathways..." 
                                           Classes="transparent" BorderThickness="0" Margin="10,5" VerticalContentAlignment="Center">
                                      <TextBox.KeyBindings>
                                          <KeyBinding Gesture="Enter" Command="{Binding SearchLearnContentCommand}" />
                                      </TextBox.KeyBindings>
                                  </TextBox>
                                  <Button Grid.Column="1" Command="{Binding SearchLearnContentCommand}" Background="Transparent" Padding="15,5">
                                      <TextBlock Text="Search" Foreground="#007ACC" FontWeight="SemiBold"/>
                                  </Button>
                              </Grid>
                          </Border>

                          <ScrollViewer Grid.Row="2" Padding="40,0,40,40">
                              <StackPanel>
                                  <ProgressBar IsIndeterminate="True" IsVisible="{Binding IsLoadingLearn}" Height="2" Margin="0,0,0,10" Foreground="#007ACC"/>
                                  
                                  <ItemsControl ItemsSource="{Binding LearnContents}">
                                      <ItemsControl.ItemsPanel>
                                          <ItemsPanelTemplate>
                                              <WrapPanel />
                                          </ItemsPanelTemplate>
                                      </ItemsControl.ItemsPanel>
                                      <ItemsControl.ItemTemplate>
                                          <DataTemplate>
                                              <Button Background="Transparent" Padding="0" Margin="0,0,20,20" 
                                                      Command="{Binding $parent[Window].((vm:MainWindowViewModel)DataContext).OpenLearnUrlCommand}"
                                                      CommandParameter="{Binding Url}">
                                                  <Border Width="280" Background="#1A1A1A" CornerRadius="12" ClipToBounds="True" BorderBrush="#333333" BorderThickness="1">
                                                      <StackPanel>
                                                          <!-- Thumbnail -->
                                                          <Panel Height="150" Background="#111111">
                                                              <Image Source="{Binding ThumbnailUrl, Converter={StaticResource PathToBitmapConverter}}" 
                                                                     Stretch="UniformToFill"/>
                                                              <!-- Badge -->
                                                              <Border HorizontalAlignment="Right" VerticalAlignment="Top" 
                                                                      Background="#CC000000" CornerRadius="0,0,0,8" Padding="8,4">
                                                                  <TextBlock Text="{Binding Type}" FontSize="10" Foreground="White" FontWeight="Bold"/>
                                                              </Border>
                                                          </Panel>
                                                          
                                                           <Border Padding="15">
                                                               <StackPanel Spacing="8">
                                                                   <TextBlock Text="{Binding Title}" FontSize="16" FontWeight="Bold" TextWrapping="Wrap" Height="44" MaxLines="2"/>
                                                                   <TextBlock Text="{Binding Description}" FontSize="12" Foreground="#888888" TextWrapping="Wrap" Height="50" MaxLines="3" TextTrimming="CharacterEllipsis"/>
                                                                   
                                                                   <Grid ColumnDefinitions="*,Auto">
                                                                       <StackPanel Orientation="Horizontal" Spacing="10">
                                                                           <TextBlock Text="{Binding Duration, StringFormat={}{0}m}" FontSize="11" Foreground="#AAAAAA"/>
                                                                           <TextBlock Text="•" Foreground="#444444"/>
                                                                           <TextBlock Text="{Binding SkillLevel}" FontSize="11" Foreground="#AAAAAA" />
                                                                       </StackPanel>
                                                                       <TextBlock Grid.Column="1" Text="→" Foreground="#007ACC" FontWeight="Bold"/>
                                                                   </Grid>
                                                               </StackPanel>
                                                           </Border>
                                                      </StackPanel>
                                                  </Border>
                                              </Button>
                                          </DataTemplate>
                                      </ItemsControl.ItemTemplate>
                                  </ItemsControl>
                              </StackPanel>
                          </ScrollViewer>
                      </Grid>
                </Grid>
           </SplitView.Content>
       </SplitView>
       
       <!-- Details Overlay -->
       <Grid IsVisible="{Binding IsDetailsOpen}" Background="#AA000000">
           <!-- Click background to close -->
           <Button Background="Transparent" HorizontalAlignment="Stretch" VerticalAlignment="Stretch" 
                   Command="{Binding CloseProjectDetailsCommand}" />
           
           <!-- Content Modal -->
           <Border Background="#252525" Width="900" Height="500" CornerRadius="12" BoxShadow="0 10 30 0 #000000">
               <Grid ColumnDefinitions="300,*" RowDefinitions="Auto,*">
                   
                   <!-- Left Sidebar: Project Info -->
                   <Border Grid.RowSpan="2" Background="#1E1E1E" CornerRadius="12,0,0,12" Padding="20">
                       <StackPanel Spacing="16">
                           <!-- Large Thumbnail -->
                           <Border CornerRadius="8" ClipToBounds="True" Height="160">
                               <Image Source="{Binding SelectedProject.ThumbnailPath, Converter={StaticResource PathToBitmapConverter}}" 
                                      Stretch="UniformToFill"/>
                           </Border>
                           
                           <TextBlock Text="{Binding SelectedProject.Name}" FontSize="24" FontWeight="Bold" TextWrapping="Wrap"/>
                           
                           <StackPanel Spacing="4">
                               <TextBlock Text="UNITY VERSION" FontWeight="Bold" FontSize="10" Foreground="#888888"/>
                               <TextBlock Text="{Binding SelectedProject.UnityVersion}" FontSize="14"/>
                           </StackPanel>
                           
                           <StackPanel Spacing="4">
                               <TextBlock Text="LOCATION" FontWeight="Bold" FontSize="10" Foreground="#888888"/>
                               <TextBlock Text="{Binding SelectedProject.Path}" FontSize="12" Foreground="#CCCCCC" TextWrapping="Wrap"/>
                           </StackPanel>

                           <Rectangle Height="1" Fill="#333333" Margin="0,10"/>

                           <Button Content="Open in Editor" Command="{Binding OpenProjectCommand}" Classes="accent" HorizontalAlignment="Stretch" Padding="0,12"/>
                           
                           <Grid ColumnDefinitions="*,Auto" Margin="0,10,0,0">
                               <Button Content="Clean Library" Command="{Binding CleanLibraryCommand}" 
                                       HorizontalAlignment="Stretch" Margin="0,0,4,0"/>
                               <!-- Potential drop down or more options -->
                               <Button Grid.Column="1" Content="..." Width="40"/>
                           </Grid>

                           <Button Content="Close Details" Command="{Binding CloseProjectDetailsCommand}" 
                                   HorizontalAlignment="Stretch" Margin="0,10,0,0" Background="Transparent" BorderBrush="#333333"/>
                       </StackPanel>
                   </Border>
                   
                   <!-- Right Content: Packages -->
                   <Border Grid.Column="1" Grid.Row="0" Padding="30,20" BorderBrush="#333333" BorderThickness="0,0,0,1">
                       <Grid ColumnDefinitions="*,Auto">
                           <TextBlock Text="Installed Packages" FontSize="20" FontWeight="SemiLight" VerticalAlignment="Center"/>
                           <!-- Future: Search Box -->
                           <Button Grid.Column="1" Content="Add Package" />
                       </Grid>
                   </Border>
                   
                   <ListBox Grid.Column="1" Grid.Row="1" ItemsSource="{Binding Packages}" Background="Transparent" Margin="0,10">
                       <ListBox.Styles>
                           <Style Selector="ListBoxItem">
                               <Setter Property="Padding" Value="20,10"/>
                           </Style>
                       </ListBox.Styles>
                       <ListBox.ItemTemplate>
                           <DataTemplate>
                               <Grid ColumnDefinitions="*,100,Auto">
                                   <StackPanel Spacing="2">
                                       <TextBlock Text="{Binding Name}" FontWeight="SemiBold" FontSize="14"/>
                                   </StackPanel>
                                   
                                   <TextBlock Grid.Column="1" Text="{Binding Version}" Foreground="#AAFFFFFF" VerticalAlignment="Center"/>
                                   
                                   <Button Grid.Column="2" Content="Remove" FontSize="11" Padding="8,4" Background="#333333"/>
                               </Grid>
                           </DataTemplate>
                       </ListBox.ItemTemplate>
                   </ListBox>
               </Grid>
           </Border>
       </Grid>
    </Grid>
</Window>
